<script>
  const SHEET_ID   = "1Gcd4D5FeI3bhveOc4n4eoPk5wpZPBi7_bg9T-9LX3XY";
  const SHEET_NAME = "Sheet1";
  const sheetUrl   = `https://opensheet.elk.sh/${SHEET_ID}/${encodeURIComponent(SHEET_NAME)}`;

  const esc = (s) => String(s ?? "")
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;");

  async function loadMenu() {
    try {
      const res = await fetch(sheetUrl);
      const data = await res.json();

      if (!Array.isArray(data) || data.length === 0) {
        throw new Error("Empty data");
      }

      // Получаем порядок колонок ровно как он идёт в таблице (по заголовкам первой строки)
      const headerOrder = Object.keys(data[0]);

      // Индексы, как в вашем старом парсере:
      const IDX_NAME     = 0;
      const IDX_PRODUCER = 1;
      const IDX_YEAR     = 4; // Vintage/Year
      const IDX_PRICE    = 7; // Price/Glass

      let html = `<div class="table-container"><table>`;

      data.forEach(row => {
        // читаем по индексам в порядке headerOrder
        const name     = (row[headerOrder[IDX_NAME]]     ?? "").toString().trim();
        const producer = (row[headerOrder[IDX_PRODUCER]] ?? "").toString().trim();
        const year     = (row[headerOrder[IDX_YEAR]]     ?? "").toString().trim();
        let   price    = (row[headerOrder[IDX_PRICE]]    ?? "").toString().trim();

        if (!name) return;
        price = price ? `€${price}` : "";

        html += `<tr>
          <td class="wine-name">${esc(name)}</td>
          <td class="producer">${esc(producer)}</td>
          <td class="year">${esc(year)}</td>
          <td class="price">${esc(price)}</td>
        </tr>`;
      });

      html += "</table></div>";
      document.getElementById("menu").innerHTML = html;
    } catch (err) {
      console.error("Error loading menu:", err);
      document.getElementById("menu").innerHTML =
        "<p>Could not load the menu. Please try again later.</p>";
    }
  }

  window.onload = loadMenu;
</script>
